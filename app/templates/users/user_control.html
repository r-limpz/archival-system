{% extends 'layout/users.html' %}
{% block title %} Users Manager | ARDS{% endblock %}
{% block style %}
{% endblock %}
<link rel="stylesheet" href="{{url_for('static', filename='css/account.css')}}">
{% block content %}

<section class="p-2">
    <div class="page-header-title p-2 border-bottom border-1 mb-4">
        <h4 class="fw-medium">Account Manager</h4>
        <p>Lorem Ipsum</p>
    </div>
    <div>
        <button> Add User</button>
    </div>

    <div class="d-flex" id="users_data"></div>

</section>
<script>
    function populateUsers() {
        fetch('/ards/admin/account_manager/display_staff_users')
            .then(response => response.json())
            .then(users => {

                let usersDataDiv = document.getElementById('users_data');
                users.forEach(user => {
                    let statusClass = user.status === 'deactivated' ? 'fc-red' : (user.online === 'online' ? 'fc-green' : 'fc-gray');
                    let card = `
        <div class="users-entry card my-2 rounded-4" style="width:50%;" id="${user.user_id}">
            <div class="card-body d-flex justify-content-between">
                <div class="me-4 account_info d-flex">
                    <div class="p-2 me-3 border rounded-4" style="width:50px;height: 50px;">
                    </div>
                    <span class="position-absolute" style="bottom:1rem; left:50px"><i class="fa-solid fa-circle me-3 ${statusClass}"></i></span>
                    <div class="p-2">
                        <p class="fw-bold">${user.fullname}</p>
                        <p class="fst-italic">${user.username}</span></p>
                    </div>
                </div>
                <div class="online_status p-2">
                    <p class="fst-italic fs-medium">${user.last_online}</p>
                </div>
                <div class="active_status p-2">
                   
                </div>
                <div class="manage_user p-2">
                    <select class='border-0 p-2 rounded-3' value = "${user.status}" id="${user.user_id}">
                        <option value="Active"> Active </option>
                        <option value="Deactivated"> Deactivate </option>
                    </select>
                </div>
                <a class ="py-3 px-2 fc-default text-decoration-none"> <span class="fa-solid fa-ellipsis-vertical"></span>  </a>
            </div>
        </div>`;
                    usersDataDiv.innerHTML += card;
                });

                let selects = document.querySelectorAll('.manage_user select');
                selects.forEach(select => {
                    select.addEventListener('change', event => {
                        let id = event.target.id;
                        let newValue = event.target.value;
                        console.log(id, newValue);
                    });
                });
            });
    }

    window.onload = (event) => {
           populateUsers();
    };
    
</script>
{% endblock%}